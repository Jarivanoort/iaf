<?xml version="1.0" encoding="UTF-8"?>
<log4j2:Configuration status="warn" name="${ctx:instance.name}" strict="true" xmlns="http://logging.apache.org/log4j/2.0/config" xmlns:log4j2="log4j-config.xsd" packages="nl.nn.adapterframework.logging">
	<!-- https://logging.apache.org/log4j/2.x/manual/customloglevels.html -->

	<Appenders>
		<Appender name="stdout" type="Console">
			<Layout type="IbisPatternLayout">
				<Pattern>%d{yyyy-MM-dd HH:mm:ss,SSS} %-5p [%t] %X{mid,cid} %c{2} - %m%n%xEx{short}</Pattern>
			</Layout>
		</Appender>
		<Appender name="file" type="RollingFile" fileName="${ctx:log.dir}/${ctx:instance.name.lc}.log" filePattern="${ctx:log.dir}/${ctx:instance.name.lc}.log.%i">
			<Filters>
				<Filter type="IbisThreadFilter" onMatch="DENY" onMismatch="NEUTRAL" regex="${ctx:log.thread.rejectRegex}" />
			</Filters>
			<Layout type="IbisPatternLayout">
				<Pattern>%d{yyyy-MM-dd HH:mm:ss,SSS} %-5p [%t] %X{mid,cid,adapter,pipe} %c{2} - %m%n%xEx{filters(${ctx:log.stacktrace.filters})}</Pattern>
			</Layout>
			<Policies>
				<Policy type="SizeBasedTriggeringPolicy" size="${ctx:log.maxFileSize}" />
			</Policies>
			<RolloverStrategy type="DefaultRolloverStrategy" max="${ctx:log.maxBackupIndex}" fileIndex="min"  />
		</Appender>
		<Appender name="security" type="RollingFile" fileName="${ctx:log.dir}/${ctx:instance.name.lc}-security.log" filePattern="${ctx:log.dir}/${ctx:instance.name.lc}-security.log.%i">
			<Layout type="PatternLayout" pattern="%d{yyyy-MM-dd HH:mm:ss,SSS} [%t] %m%n"/>
			<Policies>
				<Policy type="SizeBasedTriggeringPolicy" size="${ctx:log.maxFileSize}" />
			</Policies>
			<RolloverStrategy type="DefaultRolloverStrategy" max="${ctx:log.maxBackupIndex}" fileIndex="min" />
		</Appender>
	</Appenders>

	<Loggers>
		<Logger name="org.apache" level="INFO" />
		<Logger name="org.apache.commons" level="WARN" />
		<Logger name="org.apache.cxf" level="WARN" />
		<Logger name="org.apache.cxf.interceptor" level="WARN" />
		<Logger name="org.apache.http.headers" level="WARN" /> <!-- include a definition, enabling to increase the level in the console -->
		<Logger name="org.apache.http.wire" level="WARN" /> <!-- include a definition, enabling to increase the level in the console -->
		<Logger name="org.aspectj.weaver" level="WARN" />
		<Logger name="org.springframework.security.web" level="INFO" />
		<Logger name="org.springframework.security.ldap" level="WARN" />

		<Logger name="SEC" additivity="false" level="INFO">
			<AppenderRef ref="security"/>
		</Logger>

		<!-- This is an example of a custom logger that prints all log messages of the IbisContext class to sysout -->
		<!-- Logger name="nl.nn.adapterframework.configuration.IbisContext" level="ERROR" additivity="true">
			<AppenderRef ref="stdout"/>
		</Logger -->

		<!-- Put some loggers of special interest on DEBUG level -->
		<!-- Logger name="org.springframework" level="DEBUG" additivity="false">
			<AppenderRef ref="stdout"/>
		</Logger -->
		<!-- Logger name="org.apache.cxf" level="DEBUG" additivity="false">
			<AppenderRef ref="stdout"/>
		</Logger -->

		<Root level="${ctx:log.level}">
			<AppenderRef ref="file"/>
		</Root>
	</Loggers>
</log4j2:Configuration>
